{% extends 'base.html' %}

{% block title %}Painel Financeiro{% endblock %}

{% block content %}
<div class="painel-container">
    <h1 class="page-title">Painel Financeiro - {{ nome_mes }}</h1>

    <div class="filter-section">
        <form method="GET" action="{{ url_for('painel_routes.painel_controle') }}" class="user-filter">
            <label for="usuario_id">Selecione um Usuário:</label>
            <select name="usuario_id" id="usuario_id" onchange="this.form.submit()">
                <option value="">-- Todos os Usuários --</option>
                {% for usuario in usuarios %}
                    <option value="{{ usuario['id'] }}" {% if usuario['id'] == usuario_id %}selected{% endif %}>{{ usuario['nome'] }}</option>
                {% endfor %}
            </select>
        </form>
    </div>

    <div class="summary-cards">
        <div class="summary-card">
            <h3>Total Recebido</h3>
            <p class="amount">R$ {{ entrada_valores|sum(attribute='valor_pago')|round(2) }}</p>
        </div>
        <div class="summary-card">
            <h3>Total Despesas</h3>
            <p class="amount">R$ {{ contas|sum(attribute='valor')|round(2) }}</p>
        </div>
        <div class="summary-card">
            <h3>Saldo</h3>
            <p class="amount {% if entrada_valores|sum(attribute='valor_pago') - contas|sum(attribute='valor') >= 0 %}positive{% else %}negative{% endif %}">
                R$ {{ (entrada_valores|sum(attribute='valor_pago') - contas|sum(attribute='valor'))|round(2) }}
            </p>
        </div>
    </div>

    {% if financeiro %}
    <div class="panel-section">
        <h2>Dados Financeiros</h2>
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Data de Pagamento</th>
                        <th>Status</th>
                        <th>Observação</th>
                        <th>Valor</th>
                        <th>Meses Contratados</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in financeiro %}
                        <tr class="{% if item['status'] == 'Pago' %}status-paid{% elif item['status'] == 'Pendente' %}status-pending{% endif %}">
                            <td>{{ item['nome'] }}</td>
                            <td>{{ item['data_pagamento'] }}</td>
                            <td><span class="status-badge {{ item['status']|lower }}">{{ item['status'] }}</span></td>
                            <td>{{ item['observacao'] }}</td>
                            <td class="valor">R$ {{ item['valor'] }}</td>
                            <td>{{ item['meses_contratados'] }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
        <p class="no-data">Não há dados financeiros para este usuário neste mês.</p>
    {% endif %}

    <div class="panel-section">
        <h2>Contas a Pagar</h2>
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Descrição</th>
                        <th>Valor</th>
                        <th>Data de Vencimento</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for conta in contas %}
                    <tr class="{% if conta.status == 'Pago' %}status-paid{% elif conta.status == 'Pendente' %}status-pending{% endif %}">
                        <td>{{ conta.descricao }}</td>
                        <td class="valor">R$ {{ conta.valor }}</td>
                        <td>{{ conta.data_vencimento }}</td>
                        <td><span class="status-badge {{ conta.status|lower }}">{{ conta.status }}</span></td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" class="no-data">Nenhuma conta encontrada para este mês.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="panel-section">
        <h2>Entradas</h2>
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Valor</th>
                        <th>Data de pagamento</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entrada in entrada_valores %}
                    <tr>
                        <td>{{ entrada.nome }}</td>
                        <td class="valor">R$ {{ entrada.valor_pago }}</td>
                        <td>{{ entrada.data_pagamento }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="3" class="no-data">Nenhuma entrada encontrada para este mês.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="action-buttons">
        <a href="{{ url_for('menu_routes.menu') }}" class="btn btn-red">Voltar</a>
        <a href="{{ url_for('painel_routes.lancar_contas') }}" class="btn btn-green">Lançar Conta</a>
    </div>
</div>
{% endblock %}